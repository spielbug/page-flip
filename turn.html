<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Turn js</title>
    <style>
        html, body
        {
            height: 100%;
            margin: 0px;
            padding: 0px;
        }
        div {
            width:500px;height:500px;
            border:1px solid black;
            //overflow: hidden;
        }
        #fb {
            position:relative;
            background:silver;
        }
        .page {
            //position:absolute;
        }

    </style>
</head>
<body>

<div id="fb">
    <div class="page" id="page1" style="background: teal;">1</div>
    <div class="page" id="page2" style="background: gold;">2</div>
    <div class="page" id="page3" style="background: moccasin;">3</div>
    <div class="page" id="page4" style="background: darkcyan;">4</div>
</div>
<!--div id="fb" style="position: relative; width: 1000px; height: 500px; transform: translate3d(0px, 0px, 0px);">
    <div class="page-wrapper" page="1" style="position: absolute; overflow: hidden; width: 500.2px; height: 500.4px; top: 0px; right: 0px; left: auto; z-index: 4;"><div style="position: absolute; top: 0px; left: 0px; overflow: hidden; z-index: auto; width: 708px; height: 708px; transform-origin: 0% 0% 0px; transform: translate3d(226px, -225px, 0px) rotate(45.2283deg);"><div class="page p1 odd" id="page1" style="background: teal; float: left; width: 500.2px; height: 500.4px; position: absolute; top: 0px; left: 0px; bottom: auto; right: 0px; transform-origin: 0% 0% 0px; transform: rotate(-45.2283deg) translate3d(-226px, 225px, 0px);">1</div></div><div style="top: 0px; left: 0px; overflow: hidden; z-index: 1; width: 500.4px; height: 500.4px; background-image: -webkit-gradient(linear, 100% 0%, 93.9087% 6.04297%, color-stop(0.6, rgba(0, 0, 0, 0)), color-stop(0.8, rgba(0, 0, 0, 0.298039)), to(rgba(0, 0, 0, 0))); display: block;"></div></div><div style="pointer-events: none; position: absolute; top: 0px; left: 0px; overflow: visible; z-index: auto; display: block;"><div style="position: absolute; top: 0px; left: 498px; overflow: hidden; z-index: 8; width: 708px; height: 708px; transform-origin: 0% 0% 0px; transform: translate3d(227px, -225px, 0px) rotate(45.2283deg); display: block;"><div style="position: absolute; top: 0px; left: 0px; overflow: visible; z-index: auto; cursor: default; width: 500.4px; height: 500.4px; right: 0px; bottom: auto; transform-origin: 0% 0% 0px; transform: rotate(-45.2283deg) translate3d(223px, 275px, 0px) rotate(270.457deg);"><div style="position: absolute; top: 0px; left: 0px; overflow: hidden; z-index: 1; width: 500.4px; height: 500.4px; background-image: -webkit-gradient(linear, 0% 0%, 5.0761% 5.03581%, from(rgba(0, 0, 0, 0)), color-stop(0.8, rgba(0, 0, 0, 0.2)), to(rgba(255, 255, 255, 0.2)));"></div><div class="page p2 even" id="page2" style="background: gold; float: left; width: 500.2px; height: 500.4px; position: absolute; top: 0px; left: 0px; bottom: auto; right: auto; box-shadow: rgba(0, 0, 0, 0.0745098) 0px 0px 20px;">2</div></div></div><div style="position: absolute; top: 0px; left: 0px; overflow: hidden; z-index: 0; display: none; width: 708px; height: 708px;"><div style="position: absolute; top: 0px; left: 0px; overflow: visible; z-index: auto; cursor: default; width: 500.4px; height: 500.4px;"><div style="position: absolute; top: 0px; left: 0px; overflow: hidden; z-index: 1; width: 500.4px; height: 500.4px;"></div></div></div><div style="position: absolute; top: 0px; left: 498px; overflow: hidden; z-index: 0; display: none; width: 708px; height: 708px;"><div style="position: absolute; top: 0px; left: 0px; overflow: visible; z-index: auto; cursor: default; width: 500.4px; height: 500.4px;"><div style="position: absolute; top: 0px; left: 0px; overflow: hidden; z-index: 1; width: 500.4px; height: 500.4px;"></div></div></div><div style="position: absolute; top: 0px; left: 0px; overflow: hidden; z-index: 0; display: none; width: 708px; height: 708px;"><div style="position: absolute; top: 0px; left: 0px; overflow: visible; z-index: auto; cursor: default; width: 500.4px; height: 500.4px;"><div style="position: absolute; top: 0px; left: 0px; overflow: hidden; z-index: 1; width: 500.4px; height: 500.4px;"></div></div></div></div><div class="page-wrapper" page="2" style="position: absolute; overflow: hidden; width: 500.2px; height: 500.4px; top: 0px; left: 0px; right: auto; z-index: 0;"><div style="position: absolute; top: 0px; left: 0px; overflow: hidden; z-index: auto; width: 708px; height: 708px;"></div></div><div class="page-wrapper" page="3" style="position: absolute; overflow: hidden; width: 500.2px; height: 500.4px; top: 0px; right: 0px; left: auto; z-index: 0;"><div style="position: absolute; top: 0px; left: 0px; overflow: hidden; z-index: auto; width: 708px; height: 708px;"><div class="page p3 odd" id="page3" style="background: moccasin; float: left; width: 500.2px; height: 500.4px; position: absolute; top: 0px; left: 0px; bottom: auto; right: auto;">3</div></div><div style="top: 0px; left: 0px; overflow: hidden; z-index: 1; width: 500.4px; height: 500.4px;"></div></div><div class="page-wrapper" page="4" style="position: absolute; overflow: hidden; width: 500.2px; height: 500.4px; top: 0px; left: 0px; right: auto; z-index: 0; display: none;"><div style="position: absolute; top: 0px; left: 0px; overflow: hidden; z-index: auto; width: 708px; height: 708px;"><div class="page p4 even" id="page4" style="background: darkcyan; float: left; width: 500.2px; height: 500.4px; position: absolute; top: 0px; left: 0px; bottom: auto; right: auto;">4</div></div><div style="top: 0px; left: 0px; overflow: hidden; z-index: 1; width: 500.4px; height: 500.4px;"></div></div><div class="shadow" style="position: absolute; top: 0px; left: 500.2px; overflow: hidden; z-index: auto; width: 500.2px; height: 500.4px;"></div></div-->
</body>
<script src="libs/jquery.js"></script>
<script src="libs/turn.js"></script>
<script>

    var _w, _h, _flipper, _left, _right;
    function make(container) {
        container = $(container)
        _w = container.width()
        _h = container.height()
        container.width(_w*2+5)
        container.css({
            position : 'relative'
        })

        // make side
        _left = makeDiv(_w, _h, 'left-side')
        _left.css({
            position:'relative',
            float:'left'
        })
        _right = makeDiv(_w, _h, 'right-side')
        _right.css({
            position:'relative',
            float:'left'
        })


        var childs = container.children()
        var len=childs.length
        for(var i = 0; i<len; i++) {
            var child = $(childs[len-i-1]) // access in reversed order
            // make wrapper
            var wrapper=$('<DIV>').addClass('fb-wrapper')
            wrapper.css({
                position : 'absolute'
            })
            _right.append(wrapper)
            child.detach();
            child.appendTo(wrapper)
            //wrapper.append(child)
            //console.log(child)
        }


        container.append(_left);
        container.append(_right);

        // div for flipping
        _flipper = makeDiv(_w, _h, 'flipper')
        _flipper.css({
            'position':'absolute',
            'overflow':'hidden'
        })
        container.append(_flipper)

        return 'done'
    }

    function makeDiv(w, h, id) {
        var div = $('<div>')
        div.attr('id', id)
        div.width(w)
        div.height(h)
        return div
    }
    function deg2rad(deg) {
        return deg/180*Math.PI
    }

    function rad2deg(rad) {
        return rad*180/Math.PI
    }

    function getRotatedSize(w, h, angle) {
        var x1 = -w/2
        var x2 = w/2
        var y1 = -h/2
        var y2 = h/2
        var w = Math.max(x2*Math.cos(angle)-y2*Math.sin(angle),
            x2*Math.cos(angle)-y1*Math.sin(angle))*2
        var h = Math.max(x1*Math.sin(angle)+y2*Math.cos(angle),
            x2*Math.sin(angle)+y2*Math.cos(angle))*2
        return {'w':w, 'h':h }
    }

    function reformFlipper(w, h, angle, distance) {
        // angle : 최초 클릭후 이동점과의 각도
        // distance : 최초 클릭후 이동점과의 거리
        var rs = getRotatedSize(w, h, angle)
        //_flipper.removeAttr('style');

        var rpos = _right.position()
        _flipper.css({
            'left':(rpos.left-(rs.w-_w)/2),
            'top':(rpos.top-(rs.h-_h)/2)
        })
        _flipper.width(rs.w)
        _flipper.height(rs.h)
        _flipper.css({
            'transform':'rotateZ('+rad2deg(angle)+'deg) translate('+(-distance/2)+'px)',
        })

        reformDiv('#page1', rs.w, rs.h, -angle, distance)
    }

    function reformDiv(div, dw, dh, angle, distance) {
        if(!div.fn) div = $(div)
        var top = (dh-_h)/2
        var left = (dw-_w)/2
        div.appendTo(_flipper)
        div.css({
            //'transform':'translate('+(distance/2)+'px) rotateZ('+rad2deg(angle)+'deg)',
            'transform':'translate('+(distance/2+left)+'px, '+top+'px) rotateZ('+rad2deg(angle)+'deg)'
        })
    }
    make('#fb')
</script>
</html>